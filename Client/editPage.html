<html>
  <head>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-wEmeIV1mKuiNpC+IOBjI7aAzPcEZeedi5yW5f2yOq55WWLwNGmvvx4Um1vskeMj0"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="design.css" />
  </head>
  <body onload="pageLoad()" align="center">
    <div class="header">
      <a class="logo">Students</a>
      <div class="header-left">
        <a href="mainPage.html">Back</a>
      </div>
    </div>
    <br />

    <div class="l-form">
      <form class="form"action="mainPage.html">
        <h1 class="form-title">Edit Student Details:</h1>
        <div class="form-div">
            ID:<br>
             <input type="text" id="id" class="form-input"/>
           </div>
           <div class="form-div">
             Full Name:<br>
             <input type="text" id="fullName" class="form-input" />
           </div>
           <div class="form-div">
             Email:<br> 
             <input type="email" id="email" class="form-input" />
           </div>
           <div class="form-div">
             Faculty:<br>
             <input type="text" id="faculty" class="form-input"/>
           </div>
           <div class="form-div">
               Birth date:<br>
               <input type="date" id="date" class="form-input"/>
           </div>
           <br>
           <input type="submit" onclick="edit()" class="btn btn-primary" value="Edit" style="width: 100%;"/>
      </form>
    </div>

    <script>
      let grades = []
      async function pageLoad() {
        var id = sessionStorage.getItem("id");
        var resp = await fetch(`http://localhost:8000/students/${id}`);
        if (resp.ok) {
          var data = await resp.json();
          document.getElementById("id").value = data.id;
          document.getElementById("fullName").value = data.fullName;
          document.getElementById("email").value = data.email;
          document.getElementById("faculty").value = data.faculty;
          var onlyDate = data.birthDate.slice(0, 10);
          document.getElementById("date").value = onlyDate;
          grades = data.grades
        }
      }
      async function edit() {
        var mId = sessionStorage.getItem("id");
        console.log(mId);
        var id = document.getElementById("id").value;
        var fullName = document.getElementById("fullName").value;
        var email = document.getElementById("email").value;
        var faculty = document.getElementById("faculty").value;
        var date = document.getElementById("date").value;

        var obj = {
          id: id,
          fullName: fullName,
          email: email,
          faculty: faculty,
          birthDate: date,
          grades:grades
        };
        console.log(obj);

        try {
          var resp = await fetch(`http://localhost:8000/students/${mId}`, {
            method: "put",
            body: JSON.stringify(obj),
            headers: { "content-type": "application/json" },
          });
        } catch (e) {
          console.log(e);
        }
      }
    </script>
  </body>
</html>
