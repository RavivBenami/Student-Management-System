<html>
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-wEmeIV1mKuiNpC+IOBjI7aAzPcEZeedi5yW5f2yOq55WWLwNGmvvx4Um1vskeMj0" crossorigin="anonymous">
    <link rel="stylesheet" href="design.css">
</head>
<body onload="pageLoad()" align="center">

    <div class="header">
        <a class="logo">Students</a>
    </div>
    
    <div class="container">
      <div class="row content1">
         <table id="tbl" align="center">
           <tr>
           <th>Full Name</th>
           <th>Faculty</th>
           <th></th>
           <th></th>
           <th></th>
           </tr>
          </table>
      </div>
    </div>
    <br>
    <input type="button" value="Create New Student" onclick="createClicked()" class="btn btn-success">
    <script>

    async function pageLoad(){
        var tbl = document.getElementById("tbl")
           var resp = await fetch('http://localhost:8000/students/')
           if(resp.ok){
              var data = await resp.json();
              data.forEach(element => {
              console.log(element);
              var tr = document.createElement("tr")
              var td1 = document.createElement("td")
              td1.onclick = nameClicked.bind(this,element._id)
              var td2 = document.createElement("td")
              var td3 = document.createElement("td")
              var td4 = document.createElement("td")
              var td5 = document.createElement("td")
              td1.innerHTML = element.fullName
              td2.innerHTML = element.faculty
              td3.innerHTML = "Grades"
              td3.onclick = gradeClicked.bind(this,element._id)
              var btnEdit = document.createElement("button");
              var btnDelete = document.createElement("button");
              btnEdit.innerHTML = "Edit"
              btnDelete.innerHTML = "Delete"
              btnEdit.className = "btn btn-primary"
              btnDelete.className = "btn btn-danger"
              btnEdit.onclick = editClicked.bind(this,element._id)
              btnDelete.onclick = deleteClicked.bind(this,element._id)
              td4.appendChild(btnEdit)
              td5.appendChild(btnDelete)
              tr.append(td1,td2,td3,td4,td5);
              tbl.appendChild(tr);
              });
           } 
        }

        function editClicked(id){
            sessionStorage.setItem("id",id)
            window.location.href = "editPage.html"

        }
         async function deleteClicked(id){

            var resp  = await fetch(`http://localhost:8000/students/${id}`,{
                    method:'delete'
                });
                location.reload();


        }
        function gradeClicked(id){
            sessionStorage.setItem("id",id)
            window.location.href = "gradesPage.html"
        }
        function nameClicked(id){
            sessionStorage.setItem("id",id)
            window.location.href = "detailPage.html"

        }
        
        function createClicked(){
            window.location.href = "createPage.html"
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.min.js" integrity="sha384-lpyLfhYuitXl2zRZ5Bn2fqnhNAKOAaM/0Kr9laMspuaMiZfGmfwRNFh8HlMy49eQ" crossorigin="anonymous"></script>
</body>
</html>